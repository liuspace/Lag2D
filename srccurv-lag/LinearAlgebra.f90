!
!...Subroutine: Get eigenvalues and eigenvectors for 2x2 symmetric matrix
!
subroutine getEigensystem(matinp, eigenvect, eigenvalue,ielem)
use constant
implicit none
real*8, dimension(ndimn, ndimn), intent(in)::matinp
real*8, dimension(ndimn, ndimn), intent(out)::eigenvect
real*8, dimension(ndimn),        intent(out)::eigenvalue
integer,                          intent(in)::ielem
!
!...Local real
real*8:: a,b,c,d
real*8:: lamda1,lamda2
real*8:: matz, matt,matc,mats
real*8:: eps
!
eps = 1.d-6
!
a = matinp(1, 1)
b = matinp(1, 2)
c = matinp(2, 1)
d = matinp(2, 2)

if(b.eq.0)then
!
lamda1 = a
lamda2 = d
!
matc = 1.d0
mats = 0.d0
!

else
!
matz = (d-a)/(2.d0*b)

if(abs(matz).lt.6.d7)then
matt = sign(1.d0/(abs(matz)+sqrt(1.d0+matz**2)) ,matz)
else
matt = sign(0.5d0/abs(matz), matz)
endif
!
matc = sqrt(1.d0/(1.d0+matt**2))
mats = matc*matt
!
!if(ielem.eq.2.or.ielem.eq.31)then
!print*,'ielem eigenvalue2',ielem,lamda1,lamda2,matz,matt,b
!endif
!
matt = matt*b
!
lamda1 = a - matt
lamda2 = d + matt
!
endif
!
!
!...Part II: Specify eigenvalues and eigenvectors in order
!
if(lamda1.le.lamda2)then
!
eigenvalue(1) = lamda1
eigenvalue(2) = lamda2
!
eigenvect(1,1) = matc
eigenvect(1,2) =-mats

eigenvect(2,1) = mats
eigenvect(2,2) = matc

else
!
eigenvalue(1) = lamda2
eigenvalue(2) = lamda1
!
eigenvect(1,1) = mats
eigenvect(1,2) = matc

eigenvect(2,1) = matc
eigenvect(2,2) =-mats

endif

end subroutine getEigensystem
!
!...Symmetric matrix
!
subroutine matrix_sym(ni, nj, nq, mtlhs, rhs, mtsym, rhssym)
!
implicit none
!
integer*4, intent(in)::ni, nj, nq
real*8, dimension(ni,nj), intent(in):: mtlhs
real*8, dimension(nq,ni),    intent(in):: rhs
real*8, dimension(nj,nj), intent(out):: mtsym
real*8, dimension(nq,nj),   intent(out):: rhssym

!...Local

integer:: im, jm,km, iq

!...Zero out
mtsym  = 0.d0
rhssym = 0.d0

!...Symmetry matrix
do im = 1, nj
do jm = 1, nj
do km = 1, ni
mtsym(im, jm) = mtsym(im, jm) + mtlhs(km, im)*mtlhs(km, jm)
enddo
enddo
enddo

!...Symmetry rhs
do iq = 1 ,nq
do im = 1, nj
do km = 1, ni
rhssym(iq, im) = rhssym(iq, im) + mtlhs(km, im)*rhs(iq, km)
enddo
enddo
enddo

return
end subroutine matrix_sym
!
!...Subroutine: Get inverse small matrix for n=2,,,5....
!
subroutine Matinv225(a,b,n)

implicit none
integer, intent(in):: n
real*8, intent(in)::  a(n,n)
real*8, intent(out):: b(n,n)
real*8:: bt(n,n)
real*8 det
real*8::a11, a12, a13, a14, a15, a21, a22, a23, a24, &
a25, a31, a32, a33, a34, a35, a41, a42, a43, a44, a45,   &
a51, a52, a53, a54, a55
integer::i

! step 0: initialization for matrices L and U and b
! Fortran 90/95 aloows such operations on matrices
if(n.eq.2)then
det = a(1, 1)*a(2, 2)-a(1, 2)*a(2, 1)

b(1, 1) = a(2, 2)
b(1, 2) =-a(1, 2)
b(2, 1) =-a(2, 1)
b(2, 2) = a(1, 1)
elseif(n.eq.3)then
!
det   = a(1,1)*(a(2,2)*a(3,3)-a(2,3)*a(3,2)) &
-a(1,2)*(a(2,1)*a(3,3)-a(2,3)*a(3,1)) &
+a(1,3)*(a(2,1)*a(3,2)-a(2,2)*a(3,1))
!
b(1,1) =  a(2,2)*a(3,3) - a(2,3)*a(3,2)
b(2,1) =  a(2,3)*a(3,1) - a(2,1)*a(3,3)
b(3,1) =  a(2,1)*a(3,2) - a(2,2)*a(3,1)

b(1,2) =  a(1,3)*a(3,2) - a(1,2)*a(3,3)
b(2,2) =  a(1,1)*a(3,3) - a(1,3)*a(3,1)
b(3,2) =  a(1,2)*a(3,1) - a(1,1)*a(3,2)

b(1,3) =  a(1,2)*a(2,3) - a(1,3)*a(2,2)
b(2,3) =  a(1,3)*a(2,1) - a(1,1)*a(2,3)
b(3,3) =  a(1,1)*a(2,2) - a(1,2)*a(2,1)

elseif(n.eq.4)then
!
det  =  a(1,1)*(a(2,2)*(a(3,3)*a(4,4)-a(3,4)*a(4,3))  &
-a(2,3)*(a(3,2)*a(4,4)-a(3,4)*a(4,2))  &
+a(2,4)*(a(3,2)*a(4,3)-a(3,3)*a(4,2))) &
-a(1,2)*(a(2,1)*(a(3,3)*a(4,4)-a(3,4)*a(4,3))  &
-a(2,3)*(a(3,1)*a(4,4)-a(3,4)*a(4,1))  &
+a(2,4)*(a(3,1)*a(4,3)-a(3,3)*a(4,1))) &
+a(1,3)*(a(2,1)*(a(3,2)*a(4,4)-a(3,4)*a(4,2))  &
-a(2,2)*(a(3,1)*a(4,4)-a(3,4)*a(4,1))  &
+a(2,4)*(a(3,1)*a(4,2)-a(3,2)*a(4,1))) &
-a(1,4)*(a(2,1)*(a(3,2)*a(4,3)-a(3,3)*a(4,2))  &
-a(2,2)*(a(3,1)*a(4,3)-a(3,3)*a(4,1))  &
+a(2,3)*(a(3,1)*a(4,2)-a(3,2)*a(4,1)))

b(1,1) =  a(2,2)*(a(3,3)*a(4,4)-a(3,4)*a(4,3))-a(2,3)*(a(3,2)*a(4,4)-a(3,4)*a(4,2))+a(2,4)*(a(3,2)*a(4,3)-a(3,3)*a(4,2))
b(2,1) = -a(2,1)*(a(3,3)*a(4,4)-a(3,4)*a(4,3))+a(2,3)*(a(3,1)*a(4,4)-a(3,4)*a(4,1))-a(2,4)*(a(3,1)*a(4,3)-a(3,3)*a(4,1))
b(3,1) =  a(2,1)*(a(3,2)*a(4,4)-a(3,4)*a(4,2))-a(2,2)*(a(3,1)*a(4,4)-a(3,4)*a(4,1))+a(2,4)*(a(3,1)*a(4,2)-a(3,2)*a(4,1))
b(4,1) = -a(2,1)*(a(3,2)*a(4,3)-a(3,3)*a(4,2))+a(2,2)*(a(3,1)*a(4,3)-a(3,3)*a(4,1))-a(2,3)*(a(3,1)*a(4,2)-a(3,2)*a(4,1))

b(1,2) = -a(1,2)*(a(3,3)*a(4,4)-a(3,4)*a(4,3))+a(1,3)*(a(3,2)*a(4,4)-a(3,4)*a(4,2))-a(1,4)*(a(3,2)*a(4,3)-a(3,3)*a(4,2))
b(2,2) =  a(1,1)*(a(3,3)*a(4,4)-a(3,4)*a(4,3))-a(1,3)*(a(3,1)*a(4,4)-a(3,4)*a(4,1))+a(1,4)*(a(3,1)*a(4,3)-a(3,3)*a(4,1))
b(3,2) = -a(1,1)*(a(3,2)*a(4,4)-a(3,4)*a(4,2))+a(1,2)*(a(3,1)*a(4,4)-a(3,4)*a(4,1))-a(1,4)*(a(3,1)*a(4,2)-a(3,2)*a(4,1))
b(4,2) =  a(1,1)*(a(3,2)*a(4,3)-a(3,3)*a(4,2))-a(1,2)*(a(3,1)*a(4,3)-a(3,3)*a(4,1))+a(1,3)*(a(3,1)*a(4,2)-a(3,2)*a(4,1))

b(1,3) =  a(1,2)*(a(2,3)*a(4,4)-a(2,4)*a(4,3))-a(1,3)*(a(2,2)*a(4,4)-a(2,4)*a(4,2))+a(1,4)*(a(2,2)*a(4,3)-a(2,3)*a(4,2))
b(2,3) = -a(1,1)*(a(2,3)*a(4,4)-a(2,4)*a(4,3))+a(1,3)*(a(2,1)*a(4,4)-a(2,4)*a(4,1))-a(1,4)*(a(2,1)*a(4,3)-a(2,3)*a(4,1))
b(3,3) =  a(1,1)*(a(2,2)*a(4,4)-a(2,4)*a(4,2))-a(1,2)*(a(2,1)*a(4,4)-a(2,4)*a(4,1))+a(1,4)*(a(2,1)*a(4,2)-a(2,2)*a(4,1))
b(4,3) = -a(1,1)*(a(2,2)*a(4,3)-a(2,3)*a(4,2))+a(1,2)*(a(2,1)*a(4,3)-a(2,3)*a(4,1))-a(1,3)*(a(2,1)*a(4,2)-a(2,2)*a(4,1))

b(1,4) = -a(1,2)*(a(2,3)*a(3,4)-a(2,4)*a(3,3))+a(1,3)*(a(2,2)*a(3,4)-a(2,4)*a(3,2))-a(1,4)*(a(2,2)*a(3,3)-a(2,3)*a(3,2))
b(2,4) =  a(1,1)*(a(2,3)*a(3,4)-a(2,4)*a(3,3))-a(1,3)*(a(2,1)*a(3,4)-a(2,4)*a(3,1))+a(1,4)*(a(2,1)*a(3,3)-a(2,3)*a(3,1))
b(3,4) = -a(1,1)*(a(2,2)*a(3,4)-a(2,4)*a(3,2))+a(1,2)*(a(2,1)*a(3,4)-a(2,4)*a(3,1))-a(1,4)*(a(2,1)*a(3,2)-a(2,2)*a(3,1))
b(4,4) =  a(1,1)*(a(2,2)*a(3,3)-a(2,3)*a(3,2))-a(1,2)*(a(2,1)*a(3,3)-a(2,3)*a(3,1))+a(1,3)*(a(2,1)*a(3,2)-a(2,2)*a(3,1))
elseif(n.eq.5)then
a11=a(1,1); a12=a(1,2); a13=a(1,3); a14=a(1,4); a15=a(1,5)
a21=a(2,1); a22=a(2,2); a23=a(2,3); a24=a(2,4); a25=a(2,5)
a31=a(3,1); a32=a(3,2); a33=a(3,3); a34=a(3,4); a35=a(3,5)
a41=a(4,1); a42=a(4,2); a43=a(4,3); a44=a(4,4); a45=a(4,5)
a51=a(5,1); a52=a(5,2); a53=a(5,3); a54=a(5,4); a55=a(5,5)

det = a15*a24*a33*a42*a51-a14*a25*a33*a42*a51-a15*a23*a34*a42*a51+    &
a13*a25*a34*a42*a51+a14*a23*a35*a42*a51-a13*a24*a35*a42*a51-       &
a15*a24*a32*a43*a51+a14*a25*a32*a43*a51+a15*a22*a34*a43*a51-       &
a12*a25*a34*a43*a51-a14*a22*a35*a43*a51+a12*a24*a35*a43*a51+       &
a15*a23*a32*a44*a51-a13*a25*a32*a44*a51-a15*a22*a33*a44*a51+       &
a12*a25*a33*a44*a51+a13*a22*a35*a44*a51-a12*a23*a35*a44*a51-       &
a14*a23*a32*a45*a51+a13*a24*a32*a45*a51+a14*a22*a33*a45*a51-       &
a12*a24*a33*a45*a51-a13*a22*a34*a45*a51+a12*a23*a34*a45*a51-       &
a15*a24*a33*a41*a52+a14*a25*a33*a41*a52+a15*a23*a34*a41*a52-       &
a13*a25*a34*a41*a52-a14*a23*a35*a41*a52+a13*a24*a35*a41*a52+       &
a15*a24*a31*a43*a52-a14*a25*a31*a43*a52-a15*a21*a34*a43*a52+       &
a11*a25*a34*a43*a52+a14*a21*a35*a43*a52-a11*a24*a35*a43*a52-       &
a15*a23*a31*a44*a52+a13*a25*a31*a44*a52+a15*a21*a33*a44*a52-       &
a11*a25*a33*a44*a52-a13*a21*a35*a44*a52+a11*a23*a35*a44*a52+       &
a14*a23*a31*a45*a52-a13*a24*a31*a45*a52-a14*a21*a33*a45*a52+       &
a11*a24*a33*a45*a52+a13*a21*a34*a45*a52-a11*a23*a34*a45*a52+       &
a15*a24*a32*a41*a53-a14*a25*a32*a41*a53-a15*a22*a34*a41*a53+       &
a12*a25*a34*a41*a53+a14*a22*a35*a41*a53-a12*a24*a35*a41*a53-       &
a15*a24*a31*a42*a53+a14*a25*a31*a42*a53+a15*a21*a34*a42*a53-       &
a11*a25*a34*a42*a53-a14*a21*a35*a42*a53+a11*a24*a35*a42*a53+       &
a15*a22*a31*a44*a53-a12*a25*a31*a44*a53-a15*a21*a32*a44*a53+       &
a11*a25*a32*a44*a53+a12*a21*a35*a44*a53-a11*a22*a35*a44*a53-       &
a14*a22*a31*a45*a53+a12*a24*a31*a45*a53+a14*a21*a32*a45*a53-       &
a11*a24*a32*a45*a53-a12*a21*a34*a45*a53+a11*a22*a34*a45*a53-       &
a15*a23*a32*a41*a54+a13*a25*a32*a41*a54+a15*a22*a33*a41*a54-       &
a12*a25*a33*a41*a54-a13*a22*a35*a41*a54+a12*a23*a35*a41*a54+       &
a15*a23*a31*a42*a54-a13*a25*a31*a42*a54-a15*a21*a33*a42*a54+       &
a11*a25*a33*a42*a54+a13*a21*a35*a42*a54-a11*a23*a35*a42*a54-       &
a15*a22*a31*a43*a54+a12*a25*a31*a43*a54+a15*a21*a32*a43*a54-       &
a11*a25*a32*a43*a54-a12*a21*a35*a43*a54+a11*a22*a35*a43*a54+       &
a13*a22*a31*a45*a54-a12*a23*a31*a45*a54-a13*a21*a32*a45*a54+       &
a11*a23*a32*a45*a54+a12*a21*a33*a45*a54-a11*a22*a33*a45*a54+       &
a14*a23*a32*a41*a55-a13*a24*a32*a41*a55-a14*a22*a33*a41*a55+       &
a12*a24*a33*a41*a55+a13*a22*a34*a41*a55-a12*a23*a34*a41*a55-       &
a14*a23*a31*a42*a55+a13*a24*a31*a42*a55+a14*a21*a33*a42*a55-       &
a11*a24*a33*a42*a55-a13*a21*a34*a42*a55+a11*a23*a34*a42*a55+       &
a14*a22*a31*a43*a55-a12*a24*a31*a43*a55-a14*a21*a32*a43*a55+       &
a11*a24*a32*a43*a55+a12*a21*a34*a43*a55-a11*a22*a34*a43*a55-       &
a13*a22*a31*a44*a55+a12*a23*a31*a44*a55+a13*a21*a32*a44*a55-       &
a11*a23*a32*a44*a55-a12*a21*a33*a44*a55+a11*a22*a33*a44*a55

b(1,1) = a25*a34*a43*a52-a24*a35*a43*a52-a25*a33*a44*a52+      &
a23*a35*a44*a52+a24*a33*a45*a52-a23*a34*a45*a52-a25*a34*a42*a53+   &
a24*a35*a42*a53+a25*a32*a44*a53-a22*a35*a44*a53-a24*a32*a45*a53+   &
a22*a34*a45*a53+a25*a33*a42*a54-a23*a35*a42*a54-a25*a32*a43*a54+   &
a22*a35*a43*a54+a23*a32*a45*a54-a22*a33*a45*a54-a24*a33*a42*a55+   &
a23*a34*a42*a55+a24*a32*a43*a55-a22*a34*a43*a55-a23*a32*a44*a55+   &
a22*a33*a44*a55

b(2,1) = -a15*a34*a43*a52+a14*a35*a43*a52+a15*a33*a44*a52-     &
a13*a35*a44*a52-a14*a33*a45*a52+a13*a34*a45*a52+a15*a34*a42*a53-   &
a14*a35*a42*a53-a15*a32*a44*a53+a12*a35*a44*a53+a14*a32*a45*a53-   &
a12*a34*a45*a53-a15*a33*a42*a54+a13*a35*a42*a54+a15*a32*a43*a54-   &
a12*a35*a43*a54-a13*a32*a45*a54+a12*a33*a45*a54+a14*a33*a42*a55-   &
a13*a34*a42*a55-a14*a32*a43*a55+a12*a34*a43*a55+a13*a32*a44*a55-   &
a12*a33*a44*a55

b(3,1) = a15*a24*a43*a52-a14*a25*a43*a52-a15*a23*a44*a52+      &
a13*a25*a44*a52+a14*a23*a45*a52-a13*a24*a45*a52-a15*a24*a42*a53+   &
a14*a25*a42*a53+a15*a22*a44*a53-a12*a25*a44*a53-a14*a22*a45*a53+   &
a12*a24*a45*a53+a15*a23*a42*a54-a13*a25*a42*a54-a15*a22*a43*a54+   &
a12*a25*a43*a54+a13*a22*a45*a54-a12*a23*a45*a54-a14*a23*a42*a55+   &
a13*a24*a42*a55+a14*a22*a43*a55-a12*a24*a43*a55-a13*a22*a44*a55+   &
a12*a23*a44*a55

b(4,1) = -a15*a24*a33*a52+a14*a25*a33*a52+a15*a23*a34*a52-     &
a13*a25*a34*a52-a14*a23*a35*a52+a13*a24*a35*a52+a15*a24*a32*a53-   &
a14*a25*a32*a53-a15*a22*a34*a53+a12*a25*a34*a53+a14*a22*a35*a53-   &
a12*a24*a35*a53-a15*a23*a32*a54+a13*a25*a32*a54+a15*a22*a33*a54-   &
a12*a25*a33*a54-a13*a22*a35*a54+a12*a23*a35*a54+a14*a23*a32*a55-   &
a13*a24*a32*a55-a14*a22*a33*a55+a12*a24*a33*a55+a13*a22*a34*a55-   &
a12*a23*a34*a55

b(5,1) = a15*a24*a33*a42-a14*a25*a33*a42-a15*a23*a34*a42+      &
a13*a25*a34*a42+a14*a23*a35*a42-a13*a24*a35*a42-a15*a24*a32*a43+   &
a14*a25*a32*a43+a15*a22*a34*a43-a12*a25*a34*a43-a14*a22*a35*a43+   &
a12*a24*a35*a43+a15*a23*a32*a44-a13*a25*a32*a44-a15*a22*a33*a44+   &
a12*a25*a33*a44+a13*a22*a35*a44-a12*a23*a35*a44-a14*a23*a32*a45+   &
a13*a24*a32*a45+a14*a22*a33*a45-a12*a24*a33*a45-a13*a22*a34*a45+   &
a12*a23*a34*a45

b(1,2) = -a25*a34*a43*a51+a24*a35*a43*a51+a25*a33*a44*a51-     &
a23*a35*a44*a51-a24*a33*a45*a51+a23*a34*a45*a51+a25*a34*a41*a53-   &
a24*a35*a41*a53-a25*a31*a44*a53+a21*a35*a44*a53+a24*a31*a45*a53-   &
a21*a34*a45*a53-a25*a33*a41*a54+a23*a35*a41*a54+a25*a31*a43*a54-   &
a21*a35*a43*a54-a23*a31*a45*a54+a21*a33*a45*a54+a24*a33*a41*a55-   &
a23*a34*a41*a55-a24*a31*a43*a55+a21*a34*a43*a55+a23*a31*a44*a55-   &
a21*a33*a44*a55

b(2,2) = a15*a34*a43*a51-a14*a35*a43*a51-a15*a33*a44*a51+      &
a13*a35*a44*a51+a14*a33*a45*a51-a13*a34*a45*a51-a15*a34*a41*a53+   &
a14*a35*a41*a53+a15*a31*a44*a53-a11*a35*a44*a53-a14*a31*a45*a53+   &
a11*a34*a45*a53+a15*a33*a41*a54-a13*a35*a41*a54-a15*a31*a43*a54+   &
a11*a35*a43*a54+a13*a31*a45*a54-a11*a33*a45*a54-a14*a33*a41*a55+   &
a13*a34*a41*a55+a14*a31*a43*a55-a11*a34*a43*a55-a13*a31*a44*a55+   &
a11*a33*a44*a55

b(3,2) = -a15*a24*a43*a51+a14*a25*a43*a51+a15*a23*a44*a51-     &
a13*a25*a44*a51-a14*a23*a45*a51+a13*a24*a45*a51+a15*a24*a41*a53-   &
a14*a25*a41*a53-a15*a21*a44*a53+a11*a25*a44*a53+a14*a21*a45*a53-   &
a11*a24*a45*a53-a15*a23*a41*a54+a13*a25*a41*a54+a15*a21*a43*a54-   &
a11*a25*a43*a54-a13*a21*a45*a54+a11*a23*a45*a54+a14*a23*a41*a55-   &
a13*a24*a41*a55-a14*a21*a43*a55+a11*a24*a43*a55+a13*a21*a44*a55-   &
a11*a23*a44*a55

b(4,2) = a15*a24*a33*a51-a14*a25*a33*a51-a15*a23*a34*a51+      &
a13*a25*a34*a51+a14*a23*a35*a51-a13*a24*a35*a51-a15*a24*a31*a53+   &
a14*a25*a31*a53+a15*a21*a34*a53-a11*a25*a34*a53-a14*a21*a35*a53+   &
a11*a24*a35*a53+a15*a23*a31*a54-a13*a25*a31*a54-a15*a21*a33*a54+   &
a11*a25*a33*a54+a13*a21*a35*a54-a11*a23*a35*a54-a14*a23*a31*a55+   &
a13*a24*a31*a55+a14*a21*a33*a55-a11*a24*a33*a55-a13*a21*a34*a55+   &
a11*a23*a34*a55

b(5,2) = -a15*a24*a33*a41+a14*a25*a33*a41+a15*a23*a34*a41-     &
a13*a25*a34*a41-a14*a23*a35*a41+a13*a24*a35*a41+a15*a24*a31*a43-   &
a14*a25*a31*a43-a15*a21*a34*a43+a11*a25*a34*a43+a14*a21*a35*a43-   &
a11*a24*a35*a43-a15*a23*a31*a44+a13*a25*a31*a44+a15*a21*a33*a44-   &
a11*a25*a33*a44-a13*a21*a35*a44+a11*a23*a35*a44+a14*a23*a31*a45-   &
a13*a24*a31*a45-a14*a21*a33*a45+a11*a24*a33*a45+a13*a21*a34*a45-   &
a11*a23*a34*a45

b(1,3) = a25*a34*a42*a51-a24*a35*a42*a51-a25*a32*a44*a51+      &
a22*a35*a44*a51+a24*a32*a45*a51-a22*a34*a45*a51-a25*a34*a41*a52+   &
a24*a35*a41*a52+a25*a31*a44*a52-a21*a35*a44*a52-a24*a31*a45*a52+   &
a21*a34*a45*a52+a25*a32*a41*a54-a22*a35*a41*a54-a25*a31*a42*a54+   &
a21*a35*a42*a54+a22*a31*a45*a54-a21*a32*a45*a54-a24*a32*a41*a55+   &
a22*a34*a41*a55+a24*a31*a42*a55-a21*a34*a42*a55-a22*a31*a44*a55+   &
a21*a32*a44*a55

b(2,3) = -a15*a34*a42*a51+a14*a35*a42*a51+a15*a32*a44*a51-     &
a12*a35*a44*a51-a14*a32*a45*a51+a12*a34*a45*a51+a15*a34*a41*a52-   &
a14*a35*a41*a52-a15*a31*a44*a52+a11*a35*a44*a52+a14*a31*a45*a52-   &
a11*a34*a45*a52-a15*a32*a41*a54+a12*a35*a41*a54+a15*a31*a42*a54-   &
a11*a35*a42*a54-a12*a31*a45*a54+a11*a32*a45*a54+a14*a32*a41*a55-   &
a12*a34*a41*a55-a14*a31*a42*a55+a11*a34*a42*a55+a12*a31*a44*a55-   &
a11*a32*a44*a55

b(3,3) = a15*a24*a42*a51-a14*a25*a42*a51-a15*a22*a44*a51+      &
a12*a25*a44*a51+a14*a22*a45*a51-a12*a24*a45*a51-a15*a24*a41*a52+   &
a14*a25*a41*a52+a15*a21*a44*a52-a11*a25*a44*a52-a14*a21*a45*a52+   &
a11*a24*a45*a52+a15*a22*a41*a54-a12*a25*a41*a54-a15*a21*a42*a54+   &
a11*a25*a42*a54+a12*a21*a45*a54-a11*a22*a45*a54-a14*a22*a41*a55+   &
a12*a24*a41*a55+a14*a21*a42*a55-a11*a24*a42*a55-a12*a21*a44*a55+   &
a11*a22*a44*a55

b(4,3) = -a15*a24*a32*a51+a14*a25*a32*a51+a15*a22*a34*a51-     &
a12*a25*a34*a51-a14*a22*a35*a51+a12*a24*a35*a51+a15*a24*a31*a52-   &
a14*a25*a31*a52-a15*a21*a34*a52+a11*a25*a34*a52+a14*a21*a35*a52-   &
a11*a24*a35*a52-a15*a22*a31*a54+a12*a25*a31*a54+a15*a21*a32*a54-   &
a11*a25*a32*a54-a12*a21*a35*a54+a11*a22*a35*a54+a14*a22*a31*a55-   &
a12*a24*a31*a55-a14*a21*a32*a55+a11*a24*a32*a55+a12*a21*a34*a55-   &
a11*a22*a34*a55

b(5,3) = a15*a24*a32*a41-a14*a25*a32*a41-a15*a22*a34*a41+      &
a12*a25*a34*a41+a14*a22*a35*a41-a12*a24*a35*a41-a15*a24*a31*a42+   &
a14*a25*a31*a42+a15*a21*a34*a42-a11*a25*a34*a42-a14*a21*a35*a42+   &
a11*a24*a35*a42+a15*a22*a31*a44-a12*a25*a31*a44-a15*a21*a32*a44+   &
a11*a25*a32*a44+a12*a21*a35*a44-a11*a22*a35*a44-a14*a22*a31*a45+   &
a12*a24*a31*a45+a14*a21*a32*a45-a11*a24*a32*a45-a12*a21*a34*a45+   &
a11*a22*a34*a45

b(1,4) = -a25*a33*a42*a51+a23*a35*a42*a51+a25*a32*a43*a51-     &
a22*a35*a43*a51-a23*a32*a45*a51+a22*a33*a45*a51+a25*a33*a41*a52-   &
a23*a35*a41*a52-a25*a31*a43*a52+a21*a35*a43*a52+a23*a31*a45*a52-   &
a21*a33*a45*a52-a25*a32*a41*a53+a22*a35*a41*a53+a25*a31*a42*a53-   &
a21*a35*a42*a53-a22*a31*a45*a53+a21*a32*a45*a53+a23*a32*a41*a55-   &
a22*a33*a41*a55-a23*a31*a42*a55+a21*a33*a42*a55+a22*a31*a43*a55-   &
a21*a32*a43*a55

b(2,4) = a15*a33*a42*a51-a13*a35*a42*a51-a15*a32*a43*a51+      &
a12*a35*a43*a51+a13*a32*a45*a51-a12*a33*a45*a51-a15*a33*a41*a52+   &
a13*a35*a41*a52+a15*a31*a43*a52-a11*a35*a43*a52-a13*a31*a45*a52+   &
a11*a33*a45*a52+a15*a32*a41*a53-a12*a35*a41*a53-a15*a31*a42*a53+   &
a11*a35*a42*a53+a12*a31*a45*a53-a11*a32*a45*a53-a13*a32*a41*a55+   &
a12*a33*a41*a55+a13*a31*a42*a55-a11*a33*a42*a55-a12*a31*a43*a55+   &
a11*a32*a43*a55

b(3,4) = -a15*a23*a42*a51+a13*a25*a42*a51+a15*a22*a43*a51-     &
a12*a25*a43*a51-a13*a22*a45*a51+a12*a23*a45*a51+a15*a23*a41*a52-   &
a13*a25*a41*a52-a15*a21*a43*a52+a11*a25*a43*a52+a13*a21*a45*a52-   &
a11*a23*a45*a52-a15*a22*a41*a53+a12*a25*a41*a53+a15*a21*a42*a53-   &
a11*a25*a42*a53-a12*a21*a45*a53+a11*a22*a45*a53+a13*a22*a41*a55-   &
a12*a23*a41*a55-a13*a21*a42*a55+a11*a23*a42*a55+a12*a21*a43*a55-   &
a11*a22*a43*a55

b(4,4) = a15*a23*a32*a51-a13*a25*a32*a51-a15*a22*a33*a51+      &
a12*a25*a33*a51+a13*a22*a35*a51-a12*a23*a35*a51-a15*a23*a31*a52+   &
a13*a25*a31*a52+a15*a21*a33*a52-a11*a25*a33*a52-a13*a21*a35*a52+   &
a11*a23*a35*a52+a15*a22*a31*a53-a12*a25*a31*a53-a15*a21*a32*a53+   &
a11*a25*a32*a53+a12*a21*a35*a53-a11*a22*a35*a53-a13*a22*a31*a55+   &
a12*a23*a31*a55+a13*a21*a32*a55-a11*a23*a32*a55-a12*a21*a33*a55+   &
a11*a22*a33*a55

b(5,4) = -a15*a23*a32*a41+a13*a25*a32*a41+a15*a22*a33*a41-     &
a12*a25*a33*a41-a13*a22*a35*a41+a12*a23*a35*a41+a15*a23*a31*a42-   &
a13*a25*a31*a42-a15*a21*a33*a42+a11*a25*a33*a42+a13*a21*a35*a42-   &
a11*a23*a35*a42-a15*a22*a31*a43+a12*a25*a31*a43+a15*a21*a32*a43-   &
a11*a25*a32*a43-a12*a21*a35*a43+a11*a22*a35*a43+a13*a22*a31*a45-   &
a12*a23*a31*a45-a13*a21*a32*a45+a11*a23*a32*a45+a12*a21*a33*a45-   &
a11*a22*a33*a45

b(1,5) = a24*a33*a42*a51-a23*a34*a42*a51-a24*a32*a43*a51+      &
a22*a34*a43*a51+a23*a32*a44*a51-a22*a33*a44*a51-a24*a33*a41*a52+   &
a23*a34*a41*a52+a24*a31*a43*a52-a21*a34*a43*a52-a23*a31*a44*a52+   &
a21*a33*a44*a52+a24*a32*a41*a53-a22*a34*a41*a53-a24*a31*a42*a53+   &
a21*a34*a42*a53+a22*a31*a44*a53-a21*a32*a44*a53-a23*a32*a41*a54+   &
a22*a33*a41*a54+a23*a31*a42*a54-a21*a33*a42*a54-a22*a31*a43*a54+   &
a21*a32*a43*a54

b(2,5) = -a14*a33*a42*a51+a13*a34*a42*a51+a14*a32*a43*a51-     &
a12*a34*a43*a51-a13*a32*a44*a51+a12*a33*a44*a51+a14*a33*a41*a52-   &
a13*a34*a41*a52-a14*a31*a43*a52+a11*a34*a43*a52+a13*a31*a44*a52-   &
a11*a33*a44*a52-a14*a32*a41*a53+a12*a34*a41*a53+a14*a31*a42*a53-   &
a11*a34*a42*a53-a12*a31*a44*a53+a11*a32*a44*a53+a13*a32*a41*a54-   &
a12*a33*a41*a54-a13*a31*a42*a54+a11*a33*a42*a54+a12*a31*a43*a54-   &
a11*a32*a43*a54

b(3,5) = a14*a23*a42*a51-a13*a24*a42*a51-a14*a22*a43*a51+      &
a12*a24*a43*a51+a13*a22*a44*a51-a12*a23*a44*a51-a14*a23*a41*a52+   &
a13*a24*a41*a52+a14*a21*a43*a52-a11*a24*a43*a52-a13*a21*a44*a52+   &
a11*a23*a44*a52+a14*a22*a41*a53-a12*a24*a41*a53-a14*a21*a42*a53+   &
a11*a24*a42*a53+a12*a21*a44*a53-a11*a22*a44*a53-a13*a22*a41*a54+   &
a12*a23*a41*a54+a13*a21*a42*a54-a11*a23*a42*a54-a12*a21*a43*a54+   &
a11*a22*a43*a54

b(4,5) = -a14*a23*a32*a51+a13*a24*a32*a51+a14*a22*a33*a51-     &
a12*a24*a33*a51-a13*a22*a34*a51+a12*a23*a34*a51+a14*a23*a31*a52-   &
a13*a24*a31*a52-a14*a21*a33*a52+a11*a24*a33*a52+a13*a21*a34*a52-   &
a11*a23*a34*a52-a14*a22*a31*a53+a12*a24*a31*a53+a14*a21*a32*a53-   &
a11*a24*a32*a53-a12*a21*a34*a53+a11*a22*a34*a53+a13*a22*a31*a54-   &
a12*a23*a31*a54-a13*a21*a32*a54+a11*a23*a32*a54+a12*a21*a33*a54-   &
a11*a22*a33*a54

b(5,5) = a14*a23*a32*a41-a13*a24*a32*a41-a14*a22*a33*a41+      &
a12*a24*a33*a41+a13*a22*a34*a41-a12*a23*a34*a41-a14*a23*a31*a42+   &
a13*a24*a31*a42+a14*a21*a33*a42-a11*a24*a33*a42-a13*a21*a34*a42+   &
a11*a23*a34*a42+a14*a22*a31*a43-a12*a24*a31*a43-a14*a21*a32*a43+   &
a11*a24*a32*a43+a12*a21*a34*a43-a11*a22*a34*a43-a13*a22*a31*a44+   &
a12*a23*a31*a44+a13*a21*a32*a44-a11*a23*a32*a44-a12*a21*a33*a44+   &
a11*a22*a33*a44

!...Transpose
bt = transpose(b)
endif

!...Multiplying the factor
if(n.lt.5)then
b = b/det
else
b = bt/det
endif

!...Output
!if(abs(det).le.1d-12)then
!print*,'The Matrix determinant is zero!',n,det
!stop
!endif
end


